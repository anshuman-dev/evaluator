{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Results for {{ hackathon.name }}</h2>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <select class="form-select" onchange="window.location.href='/results/{{ hackathon.id }}?sort='+this.value">
            <option value="score_desc" {{ 'selected' if sort_order == 'score_desc' }}>High to Low Score</option>
            <option value="score_asc" {{ 'selected' if sort_order == 'score_asc' }}>Low to High Score</option>
        </select>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Project Name</th>
                <th>Score</th>
                <th>Status</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    <a href="{{ project.devfolio_link }}" target="_blank">{{ project.name }}</a>
                </td>
                <td>
                    <span class="badge bg-{% if project.score >= 80 %}success{% elif project.score >= 60 %}warning{% else %}danger{% endif %}">
                        {{ project.score|round(1) }}
                    </span>
                </td>
                <td>{{ project.evaluation_status }}</td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="showDetails('{{ project.evaluation_details|replace('\n', '\\n')|replace('"', '\\"') }}')">View</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Evaluation Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
</div>

<script>
function showDetails(details) {
    document.getElementById('modalBody').innerHTML = '<pre>' + details + '</pre>';
    new bootstrap.Modal(document.getElementById('detailsModal')).show();
}
</script>
{% endblock %}
